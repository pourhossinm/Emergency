{% extends "base.html" %}

{% block title %}چت روم - اورژانس{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='chatroom.css') }}">
{% endblock %}

{% block content %}
<div class="heading mb-4">
    <h1 class="display-4">سامانه راهنمای تصویری اورژانس</h1>
    <div class="room-info">
        <h3>شماره تماس: <span class="heading-mark">{{room_id}}</span></h3>
        <h4>نام اتاق گفتگو: <span class="heading-mark">{{user_id}}</span></h4>
        <button id="send_location_btn">📍 ارسال موقعیت</button>

    </div>
</div>

    <!-- کنترل‌ها -->
    <div id="control_box" class="row control-box shadow">
        <div class="col-12 d-flex justify-content-around align-items-center button-box">
            <button id="bttn_mute" class="btn btn-lg btn-outline-secondary rounded-circle">
                <span id="mute_icon" class="material-icons pt-2">mic</span>
            </button>
            <button id="bttn_vid_mute" class="btn btn-lg btn-outline-secondary rounded-circle">
                <span id="vid_mute_icon" class="material-icons pt-2">videocam</span>
            </button>
            <button id="call_end" class="btn btn-lg btn-danger rounded-circle">
                <span class="material-icons pt-2">call_end</span>
            </button>
        </div>
    </div>

<div class="video-container">
    <!-- Remote videos will be inserted dynamically here -->
    <div id="remote_videos" class="remote-video-area"></div>

    <!-- Local video -->
    <div id="local_video_wrapper" class="local-video-area">
        <video id="local_vid" autoplay muted></video>
    </div>
</div>



{% endblock %}

{% block extra_scripts %}
<!-- Socket.io -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.4/socket.io.js"
    integrity="sha512-YeeA/Qxn5hYdkukScTCNNOhTrv1C2RubAGButJ1rmgQwZf/HdRaCGl+JAVkqsqaNRaYNHdheiuKKuPf9mDcqKg=="
    crossorigin="anonymous"></script>

<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!-- Popper -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<!-- Bootstrap -->
<script src="{{ url_for('static', filename='bootstrap.min.js') }}"></script>

<!-- Google Material Icons -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<!-- CSS و JS اختصاصی -->
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='chatroom.css') }}">

<script>
    const myRoomID = "{{ room_id }}";
    const myUserID = "{{ user_id }}";
    const audioMuted = "{{ mute_audio }}" == "1";
    const videoMuted = "{{ mute_video }}" == "1";
    const myVideo = document.getElementById("local_vid");  // تعریف برای استفاده در js
    console.log(">> وضعیت بی‌صدا: ", audioMuted, "ویدیو خاموش:", videoMuted);
</script>

<script src="{{ url_for('static', filename='chatroom_ui.js') }}"></script>
<script src="{{ url_for('static', filename='chatroom_networking.js') }}"></script>
{% endblock %}
